<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>タイピング - t_o_d ツール</title>
        <meta name="title" content="タイピング - t_o_d ツール" />
        <meta name="description" content="タイピングツールです。" />
        <meta
            name="keywords"
            content="t_o_d, tool, tech, タイピング, プログラミング"
        />
        <meta name="author" content="t_o_d" />
        <meta name="robots" content="index, follow" />
        <meta name="language" content="Japanese" />

        <!-- Open Graph -->
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://github.com/Kamekure-Maisuke" />
        <meta property="og:title" content="タイピング - t_o_d ツール" />
        <meta property="og:description" content="これタイピングツールです。" />
        <meta property="og:locale" content="ja_JP" />
        <meta property="og:site_name" content="t_o_d Portfolio" />

        <!-- Theme Color -->
        <meta name="theme-color" content="#1f2937" />

        <link
            rel="preload"
            href="../../images/logo.webp"
            as="image"
            type="image/webp"
            fetchpriority="high"
        />
        <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
            fetchpriority="high"
        />

        <style>
            @keyframes rotate {
                from {
                    transform: rotate(0deg);
                }
                to {
                    transform: rotate(360deg);
                }
            }

            .rotating-logo {
                animation: rotate 10s linear infinite;
            }
        </style>

        <!-- Structured Data (JSON-LD) for Article -->
        <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "Tool",
                "name": "t_o_d Tool",
                "description": "t_o_dのタイピングツールです。",
                "author": {
                    "@type": "Person",
                    "name": "t_o_d"
                }
            }
        </script>
    </head>

    <body>
        <header class="container" role="banner">
            <nav>
                <ul>
                    <li>
                        <img
                            src="../../images/logo.webp"
                            alt="t_o_d logo"
                            width="120"
                            height="120"
                            fetchpriority="high"
                            loading="eager"
                            decoding="async"
                            style="vertical-align: middle; display: block"
                        />
                    </li>
                    <li>
                        <img
                            src="../../images/logo.webp"
                            alt="t_o_d logo"
                            width="120"
                            height="120"
                            loading="eager"
                            decoding="async"
                            class="rotating-logo"
                            style="vertical-align: middle; display: block"
                        />
                    </li>
                    <li>
                        <img
                            src="../../images/logo.webp"
                            alt="t_o_d logo"
                            width="120"
                            height="120"
                            loading="eager"
                            decoding="async"
                            style="vertical-align: middle; display: block"
                        />
                    </li>
                </ul>
                <ul>
                    <li><a href="/">ホーム</a></li>
                    <li><a href="/blogs/">ブログ</a></li>
                    <li><a href="/tools/">ツール</a></li>
                </ul>
            </nav>
        </header>

        <main class="container" role="main" aria-label="タイピング Tool">
            <header>
                <hgroup>
                    <h1>タイピングツール</h1>
                    <p>タイピング練習ツールです。</p>
                </hgroup>
            </header>

            <section aria-labelledby="typing-tool-heading">
                <h2 id="typing-tool-heading" hidden>タイピングツール</h2>

                <article id="game-container">
                    <header style="text-align: center">
                        <h3 id="status">スタートボタンを押してください</h3>
                        <p style="font-size: 0.9rem; color: var(--pico-muted-color); margin-top: 0.5rem;">
                            <kbd>i</kbd> スタート / <kbd>Esc</kbd> 解答 / <kbd>u</kbd> リセット
                        </p>
                    </header>

                    <div style="margin: 2rem 0">
                        <label for="text-display"
                            ><strong>お題の文章</strong></label
                        >
                        <textarea
                            id="text-display"
                            readonly
                            rows="5"
                            style="
                                font-size: 1.2rem;
                                background-color: var(--pico-background-color);
                            "
                            aria-label="お題の文章"
                        ></textarea>
                    </div>

                    <div style="margin: 2rem 0">
                        <label for="input-field"
                            ><strong>ここにタイピング</strong></label
                        >
                        <textarea
                            id="input-field"
                            placeholder="スタートボタンを押すと入力できます..."
                            disabled
                            rows="5"
                            autocomplete="off"
                            aria-label="タイピング入力欄"
                            style="font-size: 1.2rem"
                        ></textarea>
                    </div>

                    <div
                        style="
                            display: grid;
                            grid-template-columns: repeat(
                                auto-fit,
                                minmax(150px, 1fr)
                            );
                            gap: 1rem;
                            margin: 2rem 0;
                        "
                    >
                        <div style="text-align: center">
                            <strong>タイム</strong>
                            <p
                                id="timer"
                                style="font-size: 1.5rem; margin: 0.5rem 0"
                            >
                                0.0秒
                            </p>
                        </div>
                        <div style="text-align: center">
                            <strong>正確性</strong>
                            <p
                                id="accuracy"
                                style="font-size: 1.5rem; margin: 0.5rem 0"
                            >
                                -
                            </p>
                        </div>
                    </div>

                    <div
                        id="result-container"
                        style="
                            display: none;
                            margin: 2rem 0;
                            padding: 1rem;
                            border: 2px solid var(--pico-primary);
                            border-radius: 0.5rem;
                        "
                    >
                        <h4>間違い箇所の確認</h4>
                        <div style="margin: 1rem 0">
                            <strong>正解:</strong>
                            <p
                                id="correct-text-display"
                                style="
                                    font-size: 1.2rem;
                                    line-height: 2;
                                    word-wrap: break-word;
                                "
                            ></p>
                        </div>
                        <div style="margin: 1rem 0">
                            <strong>あなたの入力:</strong>
                            <p
                                id="user-text-display"
                                style="
                                    font-size: 1.2rem;
                                    line-height: 2;
                                    word-wrap: break-word;
                                "
                            ></p>
                        </div>
                        <div style="margin: 1rem 0">
                            <small>
                                <span style="color: green">■</span> 正解
                                <span style="color: red; margin-left: 1rem"
                                    >■</span
                                >
                                間違い
                                <span style="color: gray; margin-left: 1rem"
                                    >■</span
                                >
                                未入力
                            </small>
                        </div>
                    </div>

                    <footer style="text-align: center">
                        <button id="start-btn" onclick="startGame()">
                            スタート
                        </button>
                        <button
                            id="submit-btn"
                            onclick="submitAnswer()"
                            class="contrast"
                            disabled
                        >
                            解答
                        </button>
                        <button
                            id="reset-btn"
                            onclick="resetGame()"
                            class="secondary"
                            disabled
                        >
                            リセット
                        </button>
                    </footer>
                </article>

                <script>
                    // 長文リスト（乃木坂46・白石麻衣オタクが喜ぶ最高のテキスト）
                    const texts = [
                        "白石麻衣ちゃんのニックネームは、まいやん。",
                        "白石麻衣ちゃんの初センター曲は、ガールズルール。",
                        "白石麻衣ちゃんの初写真集のタイトルは、清純な大人",
                        "白石麻衣ちゃんのセカンド写真集のタイトルは、パスポート",
                        "白石麻衣ちゃん単独センターのレコード大賞受賞曲は、シンクロニシティ",
                        "白石麻衣ちゃんの個人HPは、maishiraishi-official.com",
                    ];

                    let currentText = "";
                    let startTime = null;
                    let timerInterval = null;
                    let isPlaying = false;

                    const textDisplay = document.getElementById("text-display");
                    const inputField = document.getElementById("input-field");
                    const statusText = document.getElementById("status");
                    const timerDisplay = document.getElementById("timer");
                    const accuracyDisplay = document.getElementById("accuracy");
                    const startBtn = document.getElementById("start-btn");
                    const submitBtn = document.getElementById("submit-btn");
                    const resetBtn = document.getElementById("reset-btn");
                    const resultContainer =
                        document.getElementById("result-container");
                    const correctTextDisplay = document.getElementById(
                        "correct-text-display",
                    );
                    const userTextDisplay =
                        document.getElementById("user-text-display");

                    function getRandomText() {
                        return texts[Math.floor(Math.random() * texts.length)];
                    }

                    function updateTimer() {
                        if (!startTime) return;
                        const elapsed = (Date.now() - startTime) / 1000;
                        timerDisplay.textContent = elapsed.toFixed(1) + "秒";
                    }

                    function calculateAccuracy(original, input) {
                        if (original.length === 0) return 0;

                        let matches = 0;
                        const maxLength = Math.max(
                            original.length,
                            input.length,
                        );

                        for (let i = 0; i < original.length; i++) {
                            if (i < input.length && original[i] === input[i]) {
                                matches++;
                            }
                        }

                        return Math.round((matches / original.length) * 100);
                    }

                    function displayComparison(original, input) {
                        let correctHtml = "";
                        let userHtml = "";

                        for (let i = 0; i < original.length; i++) {
                            const correctChar = original[i];
                            const userChar = i < input.length ? input[i] : "";

                            if (userChar === correctChar) {
                                // 正解
                                correctHtml += `<span style="color: green; font-weight: bold;">${correctChar}</span>`;
                                userHtml += `<span style="color: green; font-weight: bold;">${userChar}</span>`;
                            } else if (userChar === "") {
                                // 未入力
                                correctHtml += `<span style="color: gray; font-weight: bold;">${correctChar}</span>`;
                                userHtml += `<span style="color: gray;">_</span>`;
                            } else {
                                // 間違い
                                correctHtml += `<span style="color: red; font-weight: bold; background-color: rgba(255, 0, 0, 0.1);">${correctChar}</span>`;
                                userHtml += `<span style="color: red; font-weight: bold; background-color: rgba(255, 0, 0, 0.1);">${userChar}</span>`;
                            }
                        }

                        // 余分な入力がある場合
                        if (input.length > original.length) {
                            for (
                                let i = original.length;
                                i < input.length;
                                i++
                            ) {
                                userHtml += `<span style="color: orange; font-weight: bold; background-color: rgba(255, 165, 0, 0.1);">${input[i]}</span>`;
                            }
                        }

                        correctTextDisplay.innerHTML = correctHtml;
                        userTextDisplay.innerHTML = userHtml;
                    }

                    function startGame() {
                        isPlaying = true;
                        currentText = getRandomText();
                        textDisplay.value = currentText;

                        startTime = Date.now();

                        inputField.disabled = false;
                        inputField.value = "";
                        inputField.focus();

                        startBtn.disabled = true;
                        submitBtn.disabled = false;
                        resetBtn.disabled = false;

                        statusText.textContent =
                            "表示された文章をタイピングしてください";
                        timerDisplay.textContent = "0.0秒";
                        accuracyDisplay.textContent = "-";

                        timerInterval = setInterval(updateTimer, 100);
                    }

                    function submitAnswer() {
                        if (!isPlaying) return;

                        isPlaying = false;

                        if (timerInterval) {
                            clearInterval(timerInterval);
                            timerInterval = null;
                        }

                        const userInput = inputField.value;
                        const accuracy = calculateAccuracy(
                            currentText,
                            userInput,
                        );
                        const elapsed = (Date.now() - startTime) / 1000;

                        accuracyDisplay.textContent = accuracy + "%";
                        accuracyDisplay.style.color =
                            accuracy >= 90
                                ? "green"
                                : accuracy >= 70
                                  ? "orange"
                                  : "red";

                        timerDisplay.textContent = elapsed.toFixed(1) + "秒";

                        inputField.disabled = true;
                        submitBtn.disabled = true;

                        // 間違い箇所を表示
                        displayComparison(currentText, userInput);
                        resultContainer.style.display = "block";

                        if (accuracy === 100) {
                            statusText.textContent = "完璧です！素晴らしい！";
                        } else if (accuracy >= 90) {
                            statusText.textContent = "とても良くできました！";
                        } else if (accuracy >= 70) {
                            statusText.textContent = "良い調子です！";
                        } else {
                            statusText.textContent =
                                "もう一度挑戦してみましょう！";
                        }
                    }

                    function resetGame() {
                        isPlaying = false;

                        if (timerInterval) {
                            clearInterval(timerInterval);
                            timerInterval = null;
                        }

                        startTime = null;
                        currentText = "";

                        textDisplay.value = "";
                        inputField.value = "";
                        inputField.disabled = true;

                        startBtn.disabled = false;
                        submitBtn.disabled = true;
                        resetBtn.disabled = true;

                        statusText.textContent =
                            "スタートボタンを押してください";
                        timerDisplay.textContent = "0.0秒";
                        accuracyDisplay.textContent = "-";
                        accuracyDisplay.style.color = "";

                        // 結果表示を非表示
                        resultContainer.style.display = "none";
                        correctTextDisplay.innerHTML = "";
                        userTextDisplay.innerHTML = "";
                    }

                    // vi風のキーボードショートカット
                    document.addEventListener("keydown", function (e) {
                        // Escape: 解答（入力中でも有効 - vi風の操作性）
                        if (e.key === "Escape" && !submitBtn.disabled) {
                            e.preventDefault();
                            submitAnswer();
                            return;
                        }

                        // タイピング入力欄にフォーカスがある時は他のショートカット無効
                        if (document.activeElement === inputField) {
                            return;
                        }

                        // i: スタート
                        if (e.key === "i" && !startBtn.disabled) {
                            e.preventDefault();
                            startGame();
                        }

                        // u: リセット
                        if (e.key === "u" && !resetBtn.disabled) {
                            e.preventDefault();
                            resetGame();
                        }
                    });
                </script>
            </section>

            <footer role="contentinfo">
                <small>&copy; 2025 t_o_d. All rights reserved.</small>
            </footer>
        </main>
    </body>
</html>
